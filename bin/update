#!/usr/bin/env bash


vim_update() {
  vim --headless \
    -c "TSUpdateSync" \
    -c "echo '=============================> TSUpdateSync done'" \
    -c "Lazy! sync" \
    -c "echo '=============================> LazySync done'" \
    -c "MasonToolsUpdateSync" \
    -c "quitall!"
}

zsh_update() {
  local znapsrc initcmd updatecmd
  initcmd=(
    'zmodload zsh/zpty'
    'zpty firstrun zsh'
    'zpty -r firstrun'
  )
  updatecmd=(
    'zmodload zsh/zpty'
    "source $HOME/.znaprc"
    'zpty update znap pull'
    'zpty -r update'
  )

  znapsrc="$HOME/.local/share/znap/znap.zsh"

  [[ -r "$znapsrc" ]] && zsh -s < <(printf "%s\n" "${updatecmd[@]}") ||
    zsh -s < <(printf "%s\n" "${initcmd[@]}")
}

case "$1" in
  vim)
    vim_update
    ;;
  zsh)
    zsh_update
    ;;
  *)
    zsh_update
    vim_update
esac
