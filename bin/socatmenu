#!/usr/bin/env bash

IFS=: read -r -a args

echo "INPUT_COMMAND: ${args[*]}" >&2

[[ -z "$args" ]] && exit 1

gui awm setattributes class=menu instance=loop -- \
  @hidden=false @minimized=false >&2

gui awm raise class=menu instance=loop >&2

menu main "${args[@]}"

gui awm setattributes class=menu instance=loop -- \
  @hidden=true @minimized=true >&2

UEBERZUG_FIFO="$HOME/.menuloop-zug.fifo"

if [[ -n "$UEBERZUG_PREVIEW" ]]; then
  declare -A -p cmd=([action]=remove [identifier]=preview) > "$UEBERZUG_FIFO"
fi
